"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = InsertBlockObjectPlugin;

var _slate = require("slate");

var _blockTools = require("@sanity/block-tools");

function InsertBlockObjectPlugin() {
  return {
    onCommand(command, editor, next) {
      if (command.type !== 'insertBlockObject') {
        return next();
      }

      const options = command.args[0] || {};
      const objectType = options.objectType;
      const key = options.key || (0, _blockTools.randomKey)(12);

      const block = _slate.Block.create({
        type: objectType.name,
        isVoid: true,
        key: key,
        data: {
          _key: key,
          value: {
            _type: objectType.name,
            _key: key
          }
        }
      });

      const focusBlock = editor.value.focusBlock; // If the focusBlock is not void and empty, replace it with the block to insert

      if (focusBlock && !editor.query('isVoid', focusBlock) && focusBlock.nodes.size === 1 && focusBlock.text === '') {
        editor.replaceNodeByKey(focusBlock.key, block).moveTo(block.key, 0);
        return editor;
      }

      editor.insertBlock(block).moveToEndOfBlock();
      return editor;
    }

  };
}