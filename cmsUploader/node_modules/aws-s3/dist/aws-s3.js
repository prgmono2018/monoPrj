var e,t=(e=require("crypto-js"))&&"object"==typeof e&&"default"in e?e.default:e,n=new Date(+new Date+864e5).toISOString(),r=n.split("-").join("").split(":").join("").split(".").join(""),i=n.split("T")[0].split("-").join(""),o=function(){};o.getPolicy=function(e){return new Buffer(JSON.stringify({expiration:n,conditions:[{acl:"public-read"},{bucket:e.bucketName},["starts-with","$key",e.dirName?e.dirName+"/":""],["starts-with","$Content-Type",""],["starts-with","$x-amz-meta-tag",""],{"x-amz-algorithm":"AWS4-HMAC-SHA256"},{"x-amz-credential":e.accessKeyId+"/"+i+"/"+e.region+"/s3/aws4_request"},{"x-amz-date":r},{"x-amz-meta-uuid":"14365123651274"},{"x-amz-server-side-encryption":"AES256"}]})).toString("base64").replace(/\n|\r/,"")};var a=function(){};a.getSignature=function(e,n,r){var i,o,a,c,s,m;return t.HmacSHA256(r,(i=e.secretAccessKey,o=n,a=e.region,c=t.HmacSHA256(o,"AWS4"+i),s=t.HmacSHA256(a,c),m=t.HmacSHA256("s3",s),t.HmacSHA256("aws4_request",m))).toString(t.enc.Hex)};var c=function(e){this.config=e};c.prototype.uploadFile=function(e){try{var t=this;!function(e,t){if(null===e.bucketName||""===e.bucketName)throw new Error("Your bucketName cannot be empty ");if(null===e.region||""===e.region)throw new Error("Must provide a valide region in order to use your bucket");if(null===e.accessKeyId||""===e.accessKeyId)throw new Error("Must provide accessKeyId");if(null===e.secretAccessKey||""===e.secretAccessKey)throw new Error("Must provide secretAccessKey");if(!t)throw new Error("File cannot be empty")}(t.config,e);var n=new FormData,c=(t.config.dirName?t.config.dirName+"/":"")+e.name,s=function(e,t,n){switch(e){case"cn":return"https://"+t+".s3."+n+".amazonaws.com."+e;default:return"https://"+t+".s3-"+n+".amazonaws.com"}}(t.config.region.split("-")[0],t.config.bucketName,t.config.region);return n.append("key",c),n.append("acl","public-read"),n.append("Content-Type",e.type),n.append("x-amz-meta-uuid","14365123651274"),n.append("x-amz-server-side-encryption","AES256"),n.append("X-Amz-Credential",t.config.accessKeyId+"/"+i+"/"+t.config.region+"/s3/aws4_request"),n.append("X-Amz-Algorithm","AWS4-HMAC-SHA256"),n.append("X-Amz-Date",r),n.append("x-amz-meta-tag",""),n.append("Policy",o.getPolicy(t.config)),n.append("X-Amz-Signature",a.getSignature(t.config,i,o.getPolicy(t.config))),n.append("file",e),Promise.resolve(fetch(s,{method:"post",body:n})).then(function(n){return n.ok?Promise.resolve({bucket:t.config.bucketName,key:(t.config.dirName?t.config.dirName+"/":"")+e.name,location:s+"/"+(t.config.dirName?t.config.dirName+"/":"")+e.name,status:n.status}):Promise.reject(n)})}catch(e){return Promise.reject(e)}},c.prototype.deleteFile=function(e){try{return Promise.resolve(fetch("https://"+this.config.bucketName+".s3"+(this.config.region?"-"+this.config.region:"")+".amazonaws.com/"+(this.config.dirName?this.config.dirName+"/":"")+e,{method:"delete"})).then(function(t){return t.ok?Promise.resolve({ok:t.ok,status:t.status,message:"File Deleted",fileName:e}):Promise.reject(t)})}catch(e){return Promise.reject(e)}},module.exports=c;
//# sourceMappingURL=aws-s3.js.map
